{% extends "layout.html" %}
{% load static %}

{% block title %}
    Dashboard
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
    <!-- Search form -->
    <form action="{% url 'posts:search' %}" method="get">
        <input type="text" name="q" placeholder="Search...">
        <button type="submit">Search</button>
    </form>
    <div class="custom-style">
        <h1 class="text-animation">Welcome {{ user.username }} to WriteLux</h1>
        <div class="post-actions">
            <button type="button" id="create-post-btn" class="btn btn-primary">Create</button>
            <button type="button" id="read-post-btn" class="btn btn-info">Read</button>
            <button type="button" id="update-post-btn" class="btn btn-warning">Update</button>
            <button type="button" id="delete-post-btn" class="btn btn-danger">Delete</button>
        </div>
        <p>&nbsp;</p>
        <h2>Select from your posts below and use buttons above to read, update or delete post</h2>
        <!-- Grid format for posts -->
        <div class="post-grid">
            {% for post in posts %}
                <div class="post-item">
                    <input type="checkbox" name="post" value="{{ post.pk }}" class="post-checkbox">
                    {{ post.title }}
                    <!-- <a href="{% url 'posts:post_detail' pk=post.pk %}" class="post-title">{{ post.title }}</a> -->
                </div>
            {% empty %}
                <div class="post-item">
                    <p>You have no posts yet. <a href="{% url 'posts:new_post' %}"><b>Create Post</b></a></p>
                </div>
            {% endfor %}
        </div>
    </div>
    <p>&nbsp;</p>
    <p>Back to <a href="{% url 'posts:posts_list' %}">WriteLux</a></p>
{% endblock %}

{% block content1 %}
    <h2>Dashboard Area:</h2>
    <p><a href="{% url 'users:user_profile' %}"><b>View Profile</b></a></p>
    <p><a href="{% url 'users:portfolio' %}"><b>Portfolio Folder</b></a></p>
    <p><a href="{% url 'users:user-list' %}"><b>View Users</b></a></p>
    <p><a href="{% url 'users:send_message_form' %}"><b>Send Message</b></a></p>
    <p><a href="{% url 'users:inbox' %}"><b>Inbox</b></a></p>
    <p><a href="{% url 'generate_portfolio_url' %}"><b>Generate Portfolio URL</b></a></p>
    <p>&nbsp;</p> <!-- leave empty space -->
{% endblock %}

{% block content2 %}
<section id="quote-section">
    <!-- Motivational Quotes -->
    <h2>Motivational Quotes</h2>
    <blockquote id="quote">
        <!-- Quote will be dynamically inserted here -->
    </blockquote>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('.post-checkbox');
        const createBtn = document.getElementById('create-post-btn');
        const readBtn = document.getElementById('read-post-btn');
        const updateBtn = document.getElementById('update-post-btn');
        const deleteBtn = document.getElementById('delete-post-btn');
        const selectAll = document.getElementById('select-all');
    
        // Select/Deselect all checkboxes
        if (selectAll) {
            selectAll.addEventListener('change', function () {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = selectAll.checked;
                });
            });
        }
    
        // Handle create operation (no need for selected posts)
        if (createBtn) {
            createBtn.addEventListener('click', function () {
                window.location.href = "{% url 'posts:post_create' %}";
            });
        }
    
        // Handle read, update operations
        [readBtn, updateBtn].forEach(btn => {
            if (btn) {
                btn.addEventListener('click', function () {
                    const selected = document.querySelectorAll('.post-checkbox:checked');
                    if (selected.length !== 1) {
                        alert('Please select exactly one post for this action.');
                        return;
                    }
                    const postId = selected[0].value;
                    if (btn === readBtn) {
                        window.location.href = `{% url 'posts:post_detail' pk=0 %}`.replace('0', postId);
                    } else if (btn === updateBtn) {
                        window.location.href = `{% url 'posts:post_update' pk=0 %}`.replace('0', postId);
                    }
                });
            }
        });
    
        // Delete multiple posts
        if (deleteBtn) {
            deleteBtn.addEventListener('click', function () {
                const selected = document.querySelectorAll('.post-checkbox:checked');
                if (selected.length === 0) {
                    alert('Please select at least one post to delete.');
                    return;
                }
                if (confirm('Are you sure you want to delete the selected posts?')) {
                    const ids = Array.from(selected).map(checkbox => checkbox.value);
                    const url = `{% url 'posts:post_delete' pk=0 %}`.replace('0', ids.join(','));
                    fetch(url, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ ids })
                    }).then(response => {
                        if (response.ok) {
                            ids.forEach(id => {
                                const row = document.querySelector(`.post-item input[value='${id}']`).closest('.post-item');
                                if (row) row.remove();
                            });
                        } else {
                            alert('Failed to delete posts.');
                        }
                    }).catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting posts.');
                    });
                }
            });
        }
    });
</script>

<!-- javascripts for the Quote display -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const quotes = [
            {% for quote in quotes %}
                { text: "{{ quote.content }}", author: "{{ quote.author }}" }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
    
        const backgrounds = [
            "#ff7f7f", "#7fbfff", "#7fff7f", "#ffff7f", "#ff7fff", "#7fffff", "#ffa07a"
            // Add more colors or URLs for background images
        ];
    
        let currentQuoteIndex = 0;
        const quoteElement = document.getElementById("quote");
        const quoteSection = document.getElementById("quote-section");
    
        function showQuote(index) {
            const { text, author } = quotes[index];
            const background = backgrounds[index % backgrounds.length]; // Loop through backgrounds
    
            quoteElement.style.opacity = 0; // Fade out the current quote
            setTimeout(() => {
                quoteElement.innerHTML = `<div class="quote-container">"${text}"<div class="quote-author">- ${author}</div></div>`;
                quoteSection.style.backgroundColor = background; // Change background color
                quoteElement.style.opacity = 1; // Fade in the new quote
            }, 500);
        }
    
        function cycleQuotes() {
            showQuote(currentQuoteIndex);
            currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
        }
    
        // Initial display
        showQuote(currentQuoteIndex);
        setInterval(cycleQuotes, 5000); // Change quote every 5 seconds
    });
    
</script>
{% endblock %}